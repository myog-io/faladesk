FROM node:18-alpine

WORKDIR /app

# Install deps from web
COPY ./web/package.json ./web/package-lock.json* ./web/

WORKDIR /app/web
RUN npm install --legacy-peer-deps

# Copy all web source files
COPY ./web .

# Optional: Set Supabase env vars
ARG VITE_SUPABASE_URL
ARG VITE_SUPABASE_ANON_KEY
ENV VITE_SUPABASE_URL=$VITE_SUPABASE_URL
ENV VITE_SUPABASE_ANON_KEY=$VITE_SUPABASE_ANON_KEY

CMD ["npm", "run", "dev"]